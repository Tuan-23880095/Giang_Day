<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trang chủ - Tài nguyên học tập</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <!-- KaTeX (Thư viện công thức toán) - Rất quan trọng cho quiz -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>

  <!-- 
    CẬP NHẬT:
    1. Thêm KaTeX (toán).
    2. Thêm file CSS tùy chỉnh (giống file gốc).
    3. Thêm <div id="score-display"> cho thanh điểm.
    4. Cập nhật MOCK_DATA và hàm route() để thêm đề mới.
    5. Viết lại hàm showQuiz() để TẢI (fetch) JSON và RENDER quiz tương tác.
  -->
  
  <style>
    body { font-family: Inter, system-ui, sans-serif; }
    
    /* Các style từ file gốc (styles.css / index.html gốc) */
    .tab-button { @apply px-4 py-3 font-semibold text-gray-600 border-b-4 border-transparent transition-all duration-300; }
    .tab-button.active { @apply text-blue-700 border-blue-600; }
    .tab-button:hover:not(.active) { @apply text-gray-900 border-gray-300; }

    .question-card { @apply bg-white p-6 rounded-xl shadow-lg border border-gray-100 transition-all duration-300 mb-6; }
    
    .check-button {
        @apply px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-blue-700 transition-colors duration-200 cursor-pointer;
    }
    .check-button:disabled {
        @apply bg-gray-400 cursor-not-allowed hover:bg-gray-400;
    }
        
    .solution-content { @apply mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg; }
    .katex { font-size: 1.1em !important; }

    /* Lớp cho đáp án sau khi kiểm tra */
    .correct-answer { @apply bg-green-50 border-green-300; }
    .incorrect-answer { @apply bg-red-50 border-red-300; }
    .correct-answer label, .correct-answer span { @apply font-semibold text-green-700; }
    .incorrect-answer label, .incorrect-answer span { @apply font-semibold text-red-700; }

    /* Thanh điểm cố định */
    #score-display {
        @apply fixed bottom-0 left-0 w-full bg-blue-800 text-white p-4 text-xl font-bold shadow-lg text-center z-20 transition-all duration-300;
    }
  </style>

</head>
<body class="antialiased bg-[#f8f7f4] text-gray-800 pb-24"> <!-- Thêm padding-bottom -->

  <header class="bg-white shadow-md">
    <div class="container mx-auto px-4 py-5">
      <h1 class="text-3xl font-bold text-blue-800">Trang chủ: Tài nguyên học tập</h1>
      <p class="text-lg text-gray-600 mt-1">Khám phá các chủ đề và tài nguyên</p>
    </div>
  </header>

  <nav-tabs></nav-tabs>

  <main id="view" class="container mx-auto p-4 md:p-8"></main>

  <contact-footer></contact-footer>

  <!-- Thanh điểm (bị ẩn ban đầu) -->
  <div id="score-display" class="hidden">Điểm số: 0 / 0</div>

  <!-- Runtime 1 file, không cần build -->
  <script type="module">
    // ======================= DATA (mock) =======================
    const MOCK_DATA = {
      categories: {
        grades: [
          { id: 'g6',  title: 'Khối 6',  description: 'Tài nguyên học tập cho lớp 6',  icon: 'fas fa-leaf',  url: '#/grade/6' },
          { id: 'g10', title: 'Khối 10', description: 'Tài nguyên học tập cho lớp 10', icon: 'fas fa-book', url: '#/grade/10' },
          { id: 'g11', title: 'Khối 11', description: 'Tài nguyên học tập cho lớp 11', icon: 'fas fa-atom', url: '#/grade/11' }
        ],
        math: [
          // { id: 'm1', title: 'Dãy số & Cấp số (Đề mẫu)', description: 'Ôn tập dãy số, CSC, CSN', icon: 'fas fa-sort-numeric-down', url: '#/quiz/sequences-01' },
          
          // === ĐÃ CẬP NHẬT ===
          { id: 'm-new-1', title: 'Đề ❶: Cuối chương III', description: 'Đề thi từ file .docx của bạn', icon: 'fas fa-file-word', url: '#/quiz/de-cuoi-chuong-III' },
          // ===================
          
          { id: 'm2', title: 'Hình học Oxyz', description: 'Chuyên đề không gian Oxyz', icon: 'fas fa-cube', url: '#/subject/oxyz' }
        ],
        science: [
          { id: 's1', title: 'Vật Lý: Dao động', description: 'Dao động cơ và sóng', icon: 'fas fa-wave-square', url: '#/subject/physics-waves' },
          { id: 's2', title: 'Hóa học: Este', description: 'Este - Lipit', icon: 'fas fa-vial', url: '#/subject/chemistry-este' }
        ],
        other: [
          { id: 'o1', title: 'HS Nghiên cứu KHTN', description: 'Dự án & hướng dẫn NCKH', icon: 'fas fa-microscope', url: '#/activity/research' },
          { id: 'o2', title: 'Vui cùng Tinh thể', description: 'STEM nuôi tinh thể', icon: 'fas fa-gem', url: '#/activity/crystals' }
        ]
      }
    };

    // ======================= BASE COMPONENT =======================
    class BaseComponent extends HTMLElement {
      setState(p){ this.state = { ...(this.state||{}), ...p }; this.render?.(); }
    }

    // ======================= REPOSITORY (mock) ===================
    class ContentRepository { getItemsByCategoryId(id){ return Promise.resolve(MOCK_DATA.categories[id]||[]); } }

    // ======================= ITEM CARD ===========================
    class ContentItemCard extends BaseComponent {
      connectedCallback(){ this.render(); }
      render(){
        const t = this.getAttribute('data-title')||'';
        const d = this.getAttribute('data-description')||'';
        const i = this.getAttribute('data-icon')||'fas fa-circle';
        const u = this.getAttribute('data-url')||'#';
        this.innerHTML = `
          <a href="${u}" class="block h-full bg-white p-6 rounded-xl shadow-lg border border-gray-100 transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
            <div class="flex items-start space-x-4">
              <div class="text-3xl text-blue-600 w-10 text-center"><i class="${i}"></i></div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800 mb-1">${t}</h3>
                <p class="text-gray-600">${d}</p>
              </div>
            </div>
          </a>`;
      }
    }
    customElements.define('content-item-card', ContentItemCard);

    // ======================= CATEGORY BLOCK ======================
    class ContentCategory extends BaseComponent {
      constructor(){ super(); this.repo = new ContentRepository(); this.state={loading:true,items:[]}; }
      async connectedCallback(){
        this.title = this.getAttribute('data-title')||'Danh mục';
        this.iconClass = this.getAttribute('data-icon-class')||'fas fa-folder';
        this.categoryId = this.getAttribute('data-category-id');
        this.render();
        const items = await this.repo.getItemsByCategoryId(this.categoryId);
        this.setState({loading:false, items});
      }
      render(){
        const body = this.state?.loading
          ? '<div class="text-gray-500 italic">Đang tải dữ liệu...</div>'
          : `
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              ${(this.state.items||[]).map(it=>`
                <content-item-card data-title="${it.title}" data-description="${it.description}" data-icon="${it.icon}" data-url="${it.url}"></content-item-card>
              `).join('')}
            </div>`;
        this.innerHTML = `
          <section class="mb-12">
            <h2 class="text-2xl font-bold text-blue-800 mb-6 border-b-2 border-blue-200 pb-2">
              <i class="${this.iconClass} mr-3 text-blue-700"></i>${this.title}
            </h2>
            ${body}
          </section>`;
      }
    }
    customElements.define('content-category', ContentCategory);

    // ======================= INFO & FOOTER ========================
    customElements.define('my-info-card', class extends HTMLElement{
      connectedCallback(){ this.innerHTML = `
        <div class="bg-gradient-to-r from-blue-700 to-blue-900 text-white p-8 rounded-xl shadow-2xl flex items-center">
          <img src="https://placehold.co/100x100/ffffff/333333?text=Avatar" alt="Avatar" class="w-24 h-24 rounded-full border-4 border-white mr-6" />
          <div>
            <h2 class="text-3xl font-bold">Thông tin của tôi</h2>
            <p class="text-lg text-blue-200 mt-1">Chào mừng bạn đến với trang tài nguyên cá nhân.</p>
          </div>
        </div>`; }
    });
    customElements.define('contact-footer', class extends HTMLElement{
      connectedCallback(){ this.innerHTML = `
        <footer class="bg-gray-800 text-gray-300 p-8 mt-12">
          <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
              <h3 class="text-xl font-semibold text-white mb-4">Thông tin liên hệ</h3>
              <p class="mb-2"><i class="fas fa-envelope w-6"></i> email-cua-ban@gmail.com</p>
              <p class="mb-2"><i class="fas fa-phone w-6"></i> +84 123 456 789</p>
              <p class="mb-2"><i class="fas fa-map-marker-alt w-6"></i> TP. HCM</p>
            </div>
            <div>
              <h3 class="text-xl font-semibold text-white mb-4">Giới thiệu</h3>
              <p>Nơi chia sẻ tài nguyên, bài giảng và các dự án STEM.</p>
            </div>
            <div>
              <h3 class="text-xl font-semibold text-white mb-4">Liên kết nhanh</h3>
              <ul>
                <li><a href="#/" class="hover:text-white">Trang chủ</a></li>
                <li><a href="#/quiz/de-cuoi-chuong-III" class="hover:text-white">Đề mới</a></li>
              </ul>
            </div>
          </div>
        </footer>`; }
    });

    // ======================= NAV TABS =============================
    customElements.define('nav-tabs', class extends HTMLElement{
      connectedCallback(){
        this.innerHTML = `
          <nav class="bg-white border-b border-gray-200 sticky top-0 z-10">
            <div class="container mx-auto px-4">
              <div id="nav-tabs" class="flex space-x-4 py-2">
                <a href="#/" class="px-4 py-3 font-semibold text-gray-600 border-b-4 border-transparent transition-all duration-300 tab-button active">Tổng quan</a>
                
                <!-- === ĐÃ CẬP NHẬT === -->
                <a href="#/quiz/de-cuoi-chuong-III" class="px-4 py-3 font-semibold text-gray-600 border-b-4 border-transparent transition-all duration-300 tab-button">Đề ❶ (Mới)</a>
                <!-- =================== -->
                
                <a href="#/grade/10" class="px-4 py-3 font-semibold text-gray-600 border-b-4 border-transparent transition-all duration-300 tab-button">Khối 10</a>
                <a href="#/grade/11" class="px-4 py-3 font-semibold text-gray-600 border-b-4 border-transparent transition-all duration-300 tab-button">Khối 11</a>
              </div>
            </div>
          </nav>`;
        const tabs = this.querySelectorAll('.tab-button');
        const setActive = () => {
          tabs.forEach(t=>{
            t.classList.remove('active','text-blue-700','border-blue-600');
            t.classList.add('text-gray-600','border-transparent');
          });
          const current = [...tabs].find(a => a.getAttribute('href') === (location.hash||'#/'));
          if(current){
            current.classList.add('active','text-blue-700','border-blue-600');
            current.classList.remove('text-gray-600','border-transparent');
          }
        };
        addEventListener('hashchange', setActive);
        setActive();
      }
    });

    // ======================= ROUTER ===============================
    const elView = document.getElementById('view');
    const elScoreBar = document.getElementById('score-display');
    let currentQuizData = null; // Biến lưu trữ dữ liệu quiz hiện tại
    let userScore = {}; // Biến lưu điểm

    // Ẩn thanh điểm
    function hideScoreBar() {
        elScoreBar.classList.add('hidden');
    }
    // Cập nhật và hiện thanh điểm
    function updateScoreDisplay(totalPoints) {
        let totalCorrect = 0;
        
        Object.values(userScore.part1 || {}).forEach(answer => {
            if (answer.isCorrect) totalCorrect++;
        });
        Object.values(userScore.part2 || {}).forEach(question => {
            Object.values(question).forEach(subAnswer => {
                if (subAnswer.isCorrect) totalCorrect++;
            });
        });
        Object.values(userScore.part3 || {}).forEach(answer => {
            if (answer.isCorrect) totalCorrect++;
        });

        elScoreBar.textContent = `Điểm số: ${totalCorrect} / ${totalPoints || 0}`;
        elScoreBar.classList.remove('hidden');
    }
    
    // --- Hiển thị trang chủ ---
    function showHome(){
      if(!elView) return;
      hideScoreBar(); // Ẩn thanh điểm khi ở trang chủ
      elView.innerHTML = `
        <my-info-card class="mb-10"></my-info-card>
        <content-category data-category-id="grades"  data-title="Các khối lớp"             data-icon-class="fas fa-graduation-cap"></content-category>
        <content-category data-category-id="math"    data-title="Chủ đề Toán học"          data-icon-class="fas fa-calculator"></content-category>
        <content-category data-category-id="science" data-title="Chủ đề Khoa học Tự nhiên"  data-icon-class="fas fa-flask"></content-category>
        <content-category data-category-id="other"   data-title="Hoạt động khác"           data-icon-class="fas fa-palette"></content-category>
      `;
    }

    // --- Hiển thị trang khối học ---
    function showGrade(grade) {
        hideScoreBar();
        elView.innerHTML = `
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-6 border-b-2 border-blue-200 pb-2">
            <i class="fas fa-school mr-3 text-blue-700"></i>
            Tài nguyên cho khối ${grade}
            </h2>
            <p class="text-gray-600 mb-4">(Đây là trang ví dụ. Bạn có thể thêm nội dung cho khối này bằng cách sửa MOCK_DATA.)</p>
    
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <a href="#/quiz/de-cuoi-chuong-III" class="block bg-white p-6 rounded-xl shadow hover:shadow-xl transition">
                <div class="flex items-center gap-3">
                <i class="fas fa-file-alt text-2xl text-blue-700"></i>
                <div>
                    <h3 class="text-xl font-semibold text-gray-800">Đề minh hoạ: Cuối chương III</h3>
                    <p class="text-gray-600">Ôn tập dãy số, cấp số cộng, cấp số nhân.</p>
                </div>
                </div>
            </a>
            </div>
            <p class="mt-6"><a href="#/" class="text-blue-700 underline">← Quay lại trang chủ</a></p>
        </section>`;
    }

    // --- Hiển thị trang Quiz (Nâng cấp) ---
    async function showQuiz(id) {
        if (!elView) return;
        
        // Reset
        userScore = { part1: {}, part2: {}, part3: {} };
        elView.innerHTML = `<div class="text-lg text-blue-700 italic">Đang tải đề ${id}...</div>`;
        
        try {
            // 1. Tải dữ liệu JSON
            const response = await fetch(`content/quizzes/${id}.json`);
            if (!response.ok) throw new Error(`Không thể tải file: ${id}.json`);
            currentQuizData = await response.json();
            
            const quiz = currentQuizData;
            
            // 2. Render khung
            elView.innerHTML = `
                <h2 class="text-3xl font-bold text-blue-800">${quiz.title}</h2>
                <div id="quiz-part-1" class="mt-8"></div>
                <div id="quiz-part-2" class="mt-8"></div>
                <div id="quiz-part-3" class="mt-8"></div>
            `;
            
            // 3. Render từng phần
            renderPart1(quiz.parts.part1);
            renderPart2(quiz.parts.part2);
            renderPart3(quiz.parts.part3);
            
            // 4. Render công thức toán
            renderMathInElement(elView, {
                delimiters: [
                    {left: "$$", right: "$$", display: true}, {left: "$", right: "$", display: false},
                    {left: "\\(", right: "\\)", display: false}, {left: "\\[", right: "\\]", display: true}
                ]
            });
            
            // 5. Hiện thanh điểm
            updateScoreDisplay(quiz.totalPoints || 34);

        } catch (error) {
            console.error(error);
            elView.innerHTML = `<div class="p-6 bg-red-100 text-red-700 rounded-xl">Lỗi tải đề: ${error.message}</div>`;
        }
    }

    // --- Các hàm render từng phần (Lấy từ file gốc) ---
    function createQuestionCard(item, partHtml) {
        return `
            <div class="question-card">
                <div class="font-medium text-lg text-gray-900">${item.question}</div>
                ${partHtml}
                <div class="mt-6">
                    <button class="check-button" data-check-id="${item.id}" data-part="${partHtml.includes('name=') ? 'part1' : (partHtml.includes('sub-item-') ? 'part2' : 'part3')}">Kiểm tra</button>
                    <div id="solution-${item.id}" class="solution-content hidden">
                        ${item.solution}
                    </div>
                </div>
            </div>
        `;
    }

    function renderPart1(data) {
        const container = document.getElementById('quiz-part-1');
        if (!data || data.length === 0) return;
        
        container.innerHTML = `<h3 class="text-2xl font-semibold text-gray-700 border-b-2 border-gray-300 pb-2 mb-4">Phần 1: Nhiều lựa chọn</h3>`;
        
        data.forEach(item => {
            const optionsHtml = `<div class="list-none space-y-2 mt-4" id="options-${item.id}">` + 
                item.options.map((opt, index) => {
                    const value = String.fromCharCode(65 + index); // A, B, C, D
                    return `
                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-all cursor-pointer">
                        <input type="radio" name="${item.id}" value="${value}" class="mr-3 text-blue-600 focus:ring-blue-500">
                        <span class="text-gray-700">${value}. ${opt}</span>
                    </label>
                    `;
                }).join('') + `</div>`;
            container.innerHTML += createQuestionCard(item, optionsHtml);
        });
    }

    function renderPart2(data) {
        const container = document.getElementById('quiz-part-2');
        if (!data || data.length === 0) return;

        container.innerHTML = `<h3 class="text-2xl font-semibold text-gray-700 border-b-2 border-gray-300 pb-2 mb-4">Phần 2: Đúng/Sai</h3>`;
        
        data.forEach(item => {
             const optionsHtml = `<div class="list-none space-y-4 mt-4" id="options-${item.id}">` + 
                item.items.map(subItem => `
                    <div class="p-3 rounded-lg border border-gray-200" id="sub-item-${item.id}-${subItem.id}">
                        <p class="text-gray-700 mb-2">${subItem.id}) ${subItem.text}</p>
                        <div class="flex space-x-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="${item.id}-${subItem.id}" value="true" class="mr-2 text-green-600 focus:ring-green-500">
                                <span>Đúng</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="${item.id}-${subItem.id}" value="false" class="mr-2 text-red-600 focus:ring-red-500">
                                <span>Sai</span>
                            </label>
                        </div>
                    </div>
                `).join('') + `</div>`;
            container.innerHTML += createQuestionCard(item, optionsHtml);
        });
    }

    function renderPart3(data) {
        const container = document.getElementById('quiz-part-3');
        if (!data || data.length === 0) return;

        container.innerHTML = `<h3 class="text-2xl font-semibold text-gray-700 border-b-2 border-gray-300 pb-2 mb-4">Phần 3: Bài toán</h3>`;
        
        data.forEach(item => {
            const inputHtml = `
            <div class="mt-4">
                <input type="text" id="${item.id}-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Nhập câu trả lời của bạn...">
            </div>`;
            container.innerHTML += createQuestionCard(item, inputHtml);
        });
    }
    
    // --- Các hàm xử lý kiểm tra (Lấy từ file gốc) ---
    function handlePart1Check(itemId, itemData, button) {
        const selectedRadio = elView.querySelector(`input[name="${itemId}"]:checked`);
        const selectedValue = selectedRadio ? selectedRadio.value : null;
        const isCorrect = selectedValue === itemData.correctAnswer;
        
        userScore.part1[itemId] = { selected: selectedValue, correct: itemData.correctAnswer, isCorrect: isCorrect };

        const optionsLabels = elView.querySelectorAll(`#options-${itemId} label`);
        optionsLabels.forEach(label => {
            const radio = label.querySelector('input');
            label.classList.remove('correct-answer', 'incorrect-answer');
            if (radio.value === itemData.correctAnswer) {
                label.classList.add('correct-answer');
            } else if (radio.value === selectedValue) {
                label.classList.add('incorrect-answer');
            }
            radio.disabled = true;
        });
    }
    function handlePart2Check(itemId, itemData, button) {
        userScore.part2[itemId] = {};
        itemData.items.forEach(subItem => {
            const selectedRadio = elView.querySelector(`input[name="${itemId}-${subItem.id}"]:checked`);
            const selectedValue = selectedRadio ? selectedRadio.value : null;
            const isCorrect = String(selectedValue) === String(subItem.correct);

            userScore.part2[itemId][subItem.id] = { selected: selectedValue, correct: subItem.correct, isCorrect: isCorrect };
            
            const subItemDiv = elView.querySelector(`#sub-item-${itemId}-${subItem.id}`);
            subItemDiv.classList.remove('correct-answer', 'incorrect-answer');
            if (isCorrect) {
                subItemDiv.classList.add('correct-answer');
            } else {
                subItemDiv.classList.add('incorrect-answer');
            }
            subItemDiv.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);
        });
    }
    function handlePart3Check(itemId, itemData, button) {
        const inputField = elView.querySelector(`#${itemId}-input`);
        const inputValue = inputField.value.trim();
        // Cho phép nhiều đáp án đúng (ví dụ "4/5" và "0.8")
        const isCorrect = itemData.correctAnswer.map(ans => String(ans).toLowerCase()).includes(inputValue.toLowerCase());
        
        userScore.part3[itemId] = { input: inputValue, correct: itemData.correctAnswer, isCorrect: isCorrect };

        inputField.classList.remove('correct-answer', 'incorrect-answer');
        if (isCorrect) inputField.classList.add('correct-answer');
        else inputField.classList.add('incorrect-answer');
        inputField.disabled = true;
    }
    
    // --- Event Listener cho nút "Kiểm tra" ---
    elView.addEventListener('click', (e) => {
        if (e.target.matches('.check-button:not(:disabled)')) {
            const button = e.target;
            const itemId = button.dataset.checkId;
            const part = button.dataset.part;
            
            const partData = currentQuizData.parts[part];
            if (!partData) return;
            
            const itemData = partData.find(item => item.id === itemId);
            if (!itemData) return;

            // Chạy hàm kiểm tra tương ứng
            if (part === 'part1') handlePart1Check(itemId, itemData, button);
            else if (part === 'part2') handlePart2Check(itemId, itemData, button);
            else if (part === 'part3') handlePart3Check(itemId, itemData, button);
            
            // Hiện lời giải
            const solutionContent = document.getElementById(`solution-${itemId}`);
            if (solutionContent) solutionContent.classList.remove('hidden');
            
            button.disabled = true;
            button.textContent = 'Đã kiểm tra';
            
            // Cập nhật tổng điểm
            updateScoreDisplay(currentQuizData.totalPoints || 34);
        }
    });

    // --- BỘ ĐỊNH TUYẾN (ROUTER) ---
    function route(){
      const h = location.hash || '#/'
      
      // === ĐÃ CẬP NHẬT ===
      if (h.startsWith('#/quiz/de-cuoi-chuong-III')) {
        return showQuiz('de-cuoi-chuong-III');
      }
      // ===================
      
      if (h.startsWith('#/quiz/sequences-01')) { // Giữ lại đề cũ nếu cần
        return showQuiz('sequences-01');
      }
      if (h.startsWith('#/grade/')) {
        const g = h.replace('#/grade/','').trim();
        return showGrade(g);
      }
      return showHome();
    }

    window.addEventListener('hashchange', route);
    route(); // Chạy lần đầu
  </script>
</body>
</html>

